{"ast":null,"code":"import { ArrowDown, ArrowUp, Brush, Delete, Edit, Plus, Search, Timer, WarningFilled } from \"@element-plus/icons-vue\";\nimport { ElMessage } from 'element-plus';\nimport container from \"../components/container\";\nexport default {\n  name: \"Goods\",\n  components: {\n    container,\n    Timer\n  },\n  setup() {\n    return {\n      Search,\n      Brush,\n      Plus,\n      Edit,\n      ArrowUp,\n      ArrowDown,\n      Delete,\n      WarningFilled\n    };\n  },\n  data() {\n    return {\n      // 查询条件\n      query: {\n        id: '',\n        title: '',\n        categoryId: '',\n        status: ''\n      },\n      // 类目选项\n      categoryOption: [],\n      // 商品\n      goodsList: [],\n      goods: {\n        id: '',\n        categoryId: '',\n        title: '',\n        name: '',\n        price: '',\n        quantity: '',\n        imageUrl: '',\n        remark: '',\n        status: ''\n      },\n      rules: {\n        categoryId: {\n          required: true,\n          message: '请选择一个类目',\n          trigger: 'blur'\n        },\n        title: {\n          required: true,\n          message: '请输入一个标题',\n          trigger: 'blur'\n        },\n        name: {\n          required: true,\n          message: '请输入一个名称',\n          trigger: 'blur'\n        },\n        price: [{\n          required: true,\n          message: '价格不能为空',\n          trigger: 'blur'\n        }, {\n          type: 'number',\n          message: '价格必须为数字',\n          trigger: 'blur'\n        }],\n        quantity: [{\n          required: true,\n          message: '价格不能为空',\n          trigger: 'blur'\n        }, {\n          type: 'number',\n          message: '价格必须为数字',\n          trigger: 'blur'\n        }],\n        imageUrl: {\n          required: true,\n          message: '至少上传一张图片',\n          trigger: 'blur'\n        }\n      },\n      // 图片列表\n      pictureList: [],\n      // 分页\n      total: 0,\n      pageNum: 1,\n      pageSize: 10,\n      // 请求认证\n      token: '',\n      // 操作状态\n      dialogTitle: '',\n      operateType: '',\n      goodsDialogVisible: false,\n      // 空状态\n      showEmpty: false\n    };\n  },\n  mounted() {\n    this.getGoodsList();\n    this.token = localStorage.getItem('token');\n    this.goodsDialogVisible = this.$route.params.dialog;\n  },\n  methods: {\n    // 分页，处理函数\n    handleCurrentChangePrev(val) {\n      this.pageNum = val;\n      console.log(`上一页: ${val}`);\n    },\n    handleCurrentChange(val) {\n      this.pageNum = val;\n      this.getGoodsList();\n      console.log(`当前页: ${val}`);\n    },\n    handleCurrentChangeNext(val) {\n      this.pageNum = val;\n      console.log(`下一页: ${val}`);\n    },\n    // 图片上传，处理函数\n    handleImagePreview(file) {\n      this.goods.imageUrl = file.url;\n    },\n    handleImageRemove(file, fileList) {\n      this.goods.imageUrl = '';\n      console.log(file, fileList);\n    },\n    handleImageSuccess(response) {\n      this.goods.imageUrl = response.data;\n    },\n    // 添加、编辑商品\n    add() {\n      this.empty();\n      this.dialogTitle = '添加商品';\n      this.operateType = 'add';\n      this.goodsDialogVisible = true;\n    },\n    edit(index, row) {\n      this.dialogTitle = '编辑商品';\n      this.operateType = 'edit';\n      this.goods.id = row.id;\n      this.goods.categoryId = row.categoryId;\n      this.goods.title = row.title;\n      this.goods.name = row.name;\n      this.goods.price = row.price;\n      this.goods.quantity = row.quantity;\n      this.goods.imageUrl = row.imageUrl;\n      this.pictureList.push({\n        url: row.imageUrl\n      });\n      this.goods.remark = row.remark;\n      this.goods.status = row.status;\n      this.goodsDialogVisible = true;\n    },\n    changeCategory(value) {\n      this.goods.categoryId = value[1];\n    },\n    // 获取商品类目选项\n    getCategoryOption() {\n      this.$axios.get('/category/option').then(response => {\n        this.categoryOption = response.data.data;\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    // 获取商品列表\n    getGoodsList() {\n      this.$axios.get('/goods/list', {\n        params: {\n          id: this.query.id,\n          title: this.query.title,\n          categoryId: this.query.categoryId[1],\n          status: this.query.status,\n          pageNum: this.pageNum,\n          pageSize: this.pageSize,\n          sid: parseInt(localStorage.getItem('sid'))\n        }\n      }).then(response => {\n        this.total = response.data.data.total;\n        this.goodsList = response.data.data.list;\n        if (this.goodsList.length === 0) {\n          this.showEmpty = true;\n        }\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    // 商品上架、下架\n    changeStatus(status, row) {\n      this.$axios.put('/goods/status/update', {\n        id: row.id,\n        status: parseInt(status)\n      }).then(response => {\n        if (response.data.code === 200) {\n          ElMessage({\n            message: response.data.message,\n            type: 'success'\n          });\n        }\n        this.getGoodsList();\n      }).catch(error => {\n        console.log(error);\n      });\n      this.getGoodsList();\n    },\n    // 确认添加或编辑商品\n    confirmGoods() {\n      this.$refs['ruleForm'].validate(valid => {\n        if (valid) {\n          if (this.operateType === 'add') {\n            // 添加商品\n            this.$axios.post('/goods/create', {\n              categoryId: parseInt(this.goods.categoryId),\n              title: this.goods.title,\n              name: this.goods.name,\n              price: parseInt(this.goods.price),\n              quantity: parseInt(this.goods.quantity),\n              imageUrl: this.goods.imageUrl,\n              remark: this.goods.remark,\n              sid: parseInt(localStorage.getItem('sid'))\n            }).then(response => {\n              if (response.data.code === 200) {\n                ElMessage({\n                  message: response.data.message,\n                  type: 'success'\n                });\n              }\n              this.getGoodsList();\n            }).catch(error => {\n              console.log(error);\n            });\n          }\n          if (this.operateType === 'edit') {\n            // 编辑商品\n            this.$axios.put('/goods/update', this.goods).then(response => {\n              if (response.data.code === 200) {\n                ElMessage({\n                  message: response.data.message,\n                  type: 'success'\n                });\n              }\n              this.getGoodsList();\n            }).catch(error => {\n              console.log(error);\n            });\n          }\n          this.goodsDialogVisible = false;\n        } else {\n          console.log('error submit!!');\n          return false;\n        }\n      });\n    },\n    // 删除商品\n    deleteGoods(row) {\n      this.$axios.delete('/goods/delete', {\n        params: {\n          id: row.id\n        }\n      }).then(response => {\n        if (response.data.code === 200) {\n          ElMessage({\n            message: response.data.message,\n            type: 'success'\n          });\n        }\n        this.getGoodsList();\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    // 重置表单\n    resetForm(formName) {\n      this.$refs[formName].resetFields();\n      switch (formName) {\n        case 'query':\n          this.getGoodsList();\n          break;\n        case 'ruleForm':\n          this.empty();\n          break;\n        default:\n          console.log('invalid resetForm');\n      }\n    },\n    // 取消\n    cancel() {\n      this.$refs['ruleForm'].resetFields();\n      this.empty();\n      this.goodsDialogVisible = false;\n    },\n    // 清空数据\n    empty() {\n      this.goods.id = '';\n      this.goods.categoryId = '';\n      this.goods.title = '';\n      this.goods.name = '';\n      this.goods.price = '';\n      this.goods.quantity = '';\n      this.goods.picture = '';\n      this.goods.remark = '';\n      this.goods.status = '';\n      this.operateType = '';\n      this.pictureList = [];\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["ArrowDown","ArrowUp","Brush","Delete","Edit","Plus","Search","Timer","WarningFilled","ElMessage","container","name","components","setup","data","query","id","title","categoryId","status","categoryOption","goodsList","goods","price","quantity","imageUrl","remark","rules","required","message","trigger","type","pictureList","total","pageNum","pageSize","token","dialogTitle","operateType","goodsDialogVisible","showEmpty","mounted","getGoodsList","localStorage","getItem","$route","params","dialog","methods","handleCurrentChangePrev","val","console","log","handleCurrentChange","handleCurrentChangeNext","handleImagePreview","file","url","handleImageRemove","fileList","handleImageSuccess","response","add","empty","edit","index","row","push","changeCategory","value","getCategoryOption","$axios","get","then","catch","error","sid","parseInt","list","length","changeStatus","put","code","confirmGoods","$refs","validate","valid","post","deleteGoods","delete","resetForm","formName","resetFields","cancel","picture"],"sourceRoot":"","sources":["/Users/work/server/imall/web/src/view/Goods.vue"],"sourcesContent":["<template>\n  <container>\n    <!-- 商品查询 -->\n    <el-form :inline=\"true\" :model=\"query\" ref=\"query\" class=\"goods_query_form\">\n      <el-form-item prop=\"id\">\n        <el-input v-model.number=\"query.id\" placeholder=\"商品ID\"/>\n      </el-form-item>\n      <el-form-item prop=\"title\">\n        <el-input v-model=\"query.title\" placeholder=\"商品标题\"/>\n      </el-form-item>\n      <el-form-item prop=\"categoryId\">\n        <el-cascader v-model=\"query.categoryId\"\n                     :options=\"categoryOption\" @focus=\"getCategoryOption\" placeholder=\"请选择\" clearable/>\n      </el-form-item>\n      <el-form-item prop=\"status\">\n        <el-select v-model=\"query.status\" placeholder=\"商品状态\">\n          <el-option label=\"已上架\" value=\"1\"></el-option>\n          <el-option label=\"未上架\" value=\"2\"></el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" :icon=\"Search\" @click=\"getGoodsList\">查询</el-button>\n        <el-button type=\"primary\" :icon=\"Brush\" @click=\"resetForm('query')\"/>\n        <el-button type=\"primary\" :icon=\"Plus\" @click=\"add\">商品</el-button>\n      </el-form-item>\n    </el-form>\n    <!-- 商品列表 -->\n    <el-table :data=\"goodsList\" height=\"65vh\" style=\"width: 100%;\">\n      <el-table-column prop=\"name\" label=\"商品名称\" min-width=\"240\">\n        <template #default=\"scope\">\n          <div style=\"display: inline-flex;\">\n            <div class=\"goods_image_box\">\n              <el-image class=\"goods_image\" :src=\"scope.row.imageUrl\"/>\n            </div>\n            <div style=\"display: block;\">\n              <div class=\"goods_title\">{{ scope.row.title }}</div>\n              <div class=\"goods_id\">ID：{{ scope.row.id }}</div>\n            </div>\n          </div>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"price\" label=\"价格\" sortable/>\n      <el-table-column prop=\"quantity\" label=\"库存\"/>\n      <el-table-column prop=\"sales\" label=\"销量\" sortable/>\n      <el-table-column prop=\"status\" label=\"状态\">\n        <template #default=\"scope\">\n          <el-tag v-if=\"scope.row.status === 1\" size=\"small\">出售中</el-tag>\n          <el-tag v-if=\"scope.row.status === 2\" size=\"small\" type=\"success\">仓库中</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"created\" label=\"创建时间\" min-width=\"150\" sortable>\n        <template #default=\"scope\">\n          <div style=\"display: flex; align-items: center\">\n            <el-icon>\n              <timer/>\n            </el-icon>\n            <span style=\"margin-left: 10px\">{{ scope.row.created }}</span>\n          </div>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\" min-width=\"130\">\n        <template #default=\"scope\">\n          <el-button size=\"small\" :icon=\"Edit\" @click=\"edit(scope.$index, scope.row)\"/>\n          <el-button v-if=\"scope.row.status === 2\" size=\"small\" type=\"primary\" @click=\"changeStatus(1,scope.row)\">上架\n          </el-button>\n          <el-button v-if=\"scope.row.status === 1\" size=\"small\" type=\"primary\" @click=\"changeStatus(2,scope.row)\">下架\n          </el-button>\n          <el-popconfirm title=\"此操作将永久删除该信息, 是否继续?\"\n                         confirmButtonText=\"确认\"\n                         cancelButtonText=\"取消\"\n                         cancelButtonType=\"default\"\n                         :icon=\"WarningFilled\"\n                         @confirm=\"deleteGoods(scope.row)\">\n            <template #reference>\n             <el-button size=\"small\" type=\"danger\" :icon=\"Delete\"/>\n            </template>\n          </el-popconfirm>\n        </template>\n      </el-table-column>\n      <template #empty>\n        <div style=\"margin: 50px 0;\">\n          <el-empty v-if=\"showEmpty\" description=\"暂时还没有商品哦\" />\n        </div>\n      </template>\n    </el-table>\n    <div style=\"padding: 15px 0;\">\n      <el-pagination layout=\"total, prev, pager, next\"\n                   :current-page=\"pageNum\"\n                   :page-size=\"pageSize\"\n                   :total=\"total\"\n                   @current-change=\"handleCurrentChange\"\n                   @prev-click=\"handleCurrentChangePrev\"\n                   @next-click=\"handleCurrentChangeNext\" background/>\n    </div>\n    <!-- 添加、编辑商品，通用对话框 -->\n    <el-dialog :title=\"dialogTitle\" v-model=\"goodsDialogVisible\" :lock-scroll=\"false\" top=\"5vh\" width=\"45%\" @close=\"cancel\">\n      <el-form ref=\"ruleForm\" :rules=\"rules\" :model=\"goods\" label-width=\"80px\">\n        <el-form-item label=\"类目\" prop=\"categoryId\">\n          <el-cascader v-model=\"goods.categoryId\"\n                       :options=\"categoryOption\"\n                       @change=\"changeCategory\"\n                       change-on-select\n                       @focus=\"getCategoryOption\" placeholder=\"请选择\" clearable/>\n        </el-form-item>\n        <el-form-item label=\"标题\" prop=\"title\">\n          <el-input v-model=\"goods.title\" style=\"width: 90%;\" type=\"text\" maxlength=\"30\" show-word-limit/>\n        </el-form-item>\n        <el-form-item label=\"名称\" prop=\"name\">\n          <el-input v-model=\"goods.name\" style=\"width: 50%;\" type=\"text\" maxlength=\"10\" show-word-limit/>\n        </el-form-item>\n        <el-form-item label=\"价格\" prop=\"price\">\n          <el-input v-model.number=\"goods.price\" style=\"width: 50%;\">\n            <template #append>元</template>\n          </el-input>\n        </el-form-item>\n        <el-form-item label=\"数量\" prop=\"quantity\">\n          <el-input v-model.number=\"goods.quantity\" style=\"width: 50%;\">\n            <template #append>件</template>\n          </el-input>\n        </el-form-item>\n        <el-form-item label=\"图片\" prop=\"imageUrl\">\n          <el-input v-show=\"false\" v-model=\"goods.imageUrl\" />\n          <el-upload\n              action=\"http://localhost:8000/web/upload\"\n              :headers=\"{'token': token}\"\n              :limit=\"1\"\n              name=\"file\"\n              :file-list=\"pictureList\"\n              list-type=\"picture-card\"\n              :on-preview=\"handleImagePreview\"\n              :on-remove=\"handleImageRemove\"\n              :on-success=\"handleImageSuccess\">\n            <div class=\"goods_image_upload_icon\">+</div>\n          </el-upload>\n        </el-form-item>\n        <el-form-item label=\"备注\">\n          <el-input v-model=\"goods.remark\"\n                    style=\"width: 90%;\"\n                    type=\"textarea\"\n                    maxlength=\"100\"\n                    :autosize=\"{ minRows: 2}\" show-word-limit/>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"cancel\">取消</el-button>\n          <el-button @click=\"resetForm('ruleForm')\">重置</el-button>\n          <el-button type=\"primary\" @click=\"confirmGoods\">确定</el-button>\n        </span>\n      </template>\n    </el-dialog>\n  </container>\n</template>\n\n<script>\nimport {ArrowDown, ArrowUp, Brush, Delete, Edit, Plus, Search, Timer, WarningFilled} from \"@element-plus/icons-vue\";\nimport {ElMessage} from 'element-plus'\nimport container from \"../components/container\";\n\nexport default {\n  name: \"Goods\",\n  components: {container, Timer,},\n  setup() {\n    return {Search, Brush, Plus, Edit, ArrowUp, ArrowDown, Delete, WarningFilled}\n  },\n  data() {\n    return {\n\n      // 查询条件\n      query: {\n        id: '',\n        title: '',\n        categoryId: '',\n        status: ''\n      },\n\n      // 类目选项\n      categoryOption: [],\n\n      // 商品\n      goodsList: [],\n      goods: {\n        id: '',\n        categoryId: '',\n        title: '',\n        name: '',\n        price: '',\n        quantity: '',\n        imageUrl: '',\n        remark: '',\n        status: ''\n      },\n\n      rules: {\n        categoryId: { required: true, message: '请选择一个类目', trigger: 'blur' },\n        title: { required: true, message: '请输入一个标题', trigger: 'blur' },\n        name: { required: true, message: '请输入一个名称', trigger: 'blur' },\n        price: [ {required: true, message: '价格不能为空', trigger: 'blur' },{type: 'number',message: '价格必须为数字', trigger: 'blur'}],\n        quantity: [ {required: true, message: '价格不能为空', trigger: 'blur' },{type: 'number',message: '价格必须为数字', trigger: 'blur'}],\n        imageUrl: { required: true, message: '至少上传一张图片', trigger: 'blur' },\n      },\n\n      // 图片列表\n      pictureList: [],\n\n      // 分页\n      total: 0,\n      pageNum: 1,\n      pageSize: 10,\n\n      // 请求认证\n      token: '',\n\n      // 操作状态\n      dialogTitle: '',\n      operateType: '',\n      goodsDialogVisible: false,\n\n      // 空状态\n      showEmpty: false\n    }\n  },\n  mounted() {\n    this.getGoodsList()\n    this.token = localStorage.getItem('token')\n    this.goodsDialogVisible = this.$route.params.dialog\n  },\n  methods: {\n\n    // 分页，处理函数\n    handleCurrentChangePrev(val) {\n      this.pageNum = val;\n      console.log(`上一页: ${val}`);\n    },\n    handleCurrentChange(val) {\n      this.pageNum = val;\n      this.getGoodsList();\n      console.log(`当前页: ${val}`);\n    },\n    handleCurrentChangeNext(val) {\n      this.pageNum = val;\n      console.log(`下一页: ${val}`);\n    },\n\n    // 图片上传，处理函数\n    handleImagePreview(file) {\n      this.goods.imageUrl = file.url\n    },\n    handleImageRemove(file, fileList) {\n      this.goods.imageUrl = ''\n      console.log(file, fileList)\n    },\n    handleImageSuccess(response) {\n      this.goods.imageUrl = response.data\n    },\n\n    // 添加、编辑商品\n    add() {\n      this.empty()\n      this.dialogTitle = '添加商品'\n      this.operateType = 'add'\n      this.goodsDialogVisible = true\n    },\n    edit(index, row) {\n      this.dialogTitle = '编辑商品'\n      this.operateType = 'edit'\n      this.goods.id = row.id\n      this.goods.categoryId = row.categoryId\n      this.goods.title = row.title\n      this.goods.name = row.name\n      this.goods.price = row.price\n      this.goods.quantity = row.quantity\n      this.goods.imageUrl = row.imageUrl\n      this.pictureList.push({url: row.imageUrl})\n      this.goods.remark = row.remark\n      this.goods.status = row.status\n      this.goodsDialogVisible = true\n    },\n\n    changeCategory(value) {\n      this.goods.categoryId = value[1]\n    },\n\n    // 获取商品类目选项\n    getCategoryOption() {\n      this.$axios.get('/category/option').then((response) => {\n        this.categoryOption = response.data.data;\n      }).catch((error) => {\n        console.log(error)\n      })\n    },\n\n    // 获取商品列表\n    getGoodsList() {\n      this.$axios.get('/goods/list', {\n        params: {\n          id: this.query.id,\n          title: this.query.title,\n          categoryId: this.query.categoryId[1],\n          status: this.query.status,\n          pageNum: this.pageNum,\n          pageSize: this.pageSize,\n          sid: parseInt(localStorage.getItem('sid'))\n        }\n      }).then((response) => {\n        this.total = response.data.data.total;\n        this.goodsList = response.data.data.list;\n        if (this.goodsList.length === 0) {\n          this.showEmpty = true\n        }\n      }).catch((error) => {\n        console.log(error)\n      })\n    },\n\n    // 商品上架、下架\n    changeStatus(status, row) {\n      this.$axios.put('/goods/status/update', {\n        id: row.id,\n        status: parseInt(status)\n      }).then((response) => {\n        if (response.data.code === 200) {\n          ElMessage({message: response.data.message, type: 'success'})\n        }\n        this.getGoodsList()\n      }).catch((error) => {\n        console.log(error)\n      })\n      this.getGoodsList()\n    },\n\n    // 确认添加或编辑商品\n    confirmGoods() {\n      this.$refs['ruleForm'].validate((valid) => {\n        if (valid) {\n          if (this.operateType === 'add') {\n            // 添加商品\n            this.$axios.post('/goods/create', {\n              categoryId: parseInt(this.goods.categoryId),\n              title: this.goods.title,\n              name: this.goods.name,\n              price: parseInt(this.goods.price),\n              quantity: parseInt(this.goods.quantity),\n              imageUrl: this.goods.imageUrl,\n              remark: this.goods.remark,\n              sid: parseInt(localStorage.getItem('sid'))\n            }).then((response) => {\n              if (response.data.code === 200) {\n                ElMessage({message: response.data.message, type: 'success'})\n              }\n              this.getGoodsList()\n            }).catch((error) => {\n              console.log(error)\n            })\n          }\n          if (this.operateType === 'edit') {\n            // 编辑商品\n            this.$axios.put('/goods/update', this.goods).then((response) => {\n              if (response.data.code === 200) {\n                ElMessage({message: response.data.message, type: 'success'})\n              }\n              this.getGoodsList()\n            }).catch((error) => {\n              console.log(error)\n            })\n          }\n          this.goodsDialogVisible = false\n        } else {\n          console.log('error submit!!')\n          return false\n        }\n      })\n    },\n\n    // 删除商品\n    deleteGoods(row) {\n      this.$axios.delete('/goods/delete', {\n          params: {\n            id: row.id\n          }\n        }).then((response) => {\n          if (response.data.code === 200) {\n            ElMessage({message: response.data.message, type: 'success'})\n          }\n          this.getGoodsList()\n        }).catch((error) => {\n          console.log(error)\n      })\n    },\n\n    // 重置表单\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n      switch (formName) {\n        case 'query': this.getGoodsList(); break;\n        case 'ruleForm': this.empty(); break;\n        default: console.log('invalid resetForm');\n      }\n    },\n\n    // 取消\n    cancel() {\n      this.$refs['ruleForm'].resetFields()\n      this.empty()\n      this.goodsDialogVisible = false\n    },\n\n    // 清空数据\n    empty() {\n      this.goods.id = ''\n      this.goods.categoryId = ''\n      this.goods.title = ''\n      this.goods.name = ''\n      this.goods.price = ''\n      this.goods.quantity = ''\n      this.goods.picture = ''\n      this.goods.remark = ''\n      this.goods.status = ''\n      this.operateType = ''\n      this.pictureList = []\n    }\n  }\n}\n</script>\n<style>\n.goods_query_form {\n  margin: 6px 0;\n  display: inline-flex;\n}\n\n.goods_image_box {\n  margin: 4px 5px 5px 0;\n}\n\n.goods_image_box, .goods_image {\n  width: 62px;\n  height: 62px;\n  border-radius: 5px;\n}\n\n.goods_title {\n  font-size: 13px;\n  font-weight: 450;\n  margin: 2px 3px 1px;\n}\n\n.goods_id {\n  margin: 0 3px;\n  font-size: 12px;\n  font-weight: 450;\n}\n\n.goods_image_upload_icon {\n  color: #9aa9b9;\n  font-size: 24px;\n  font-weight: 200;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n}\n.el-dialog {\n    border-radius: 10px !important;\n}\n\n.el-upload{\n  width: 100px;\n  height: 100px;\n  line-height: 100px;\n  font-size: 16px;\n}\n\n.el-upload--picture-card {\n  background-color: #F2F4F7;\n  border: none;\n}\n\n.el-upload--picture-card{\n  width: 100px;\n  height: 100px;\n  margin-top: 0;\n  font-size: 16px !important;\n}\n\n.el-upload-list--picture-card .el-upload-list__item{\n  width: 100px;\n  height: 100px;\n  line-height: 100px;\n  font-size: 16px;\n}\n\n.el-upload-list--picture-card .el-upload-list__item-thumbnail{\n  width: 100px;\n  height: 100px;\n  line-height: 100px;\n  font-size: 16px;\n}\n\n.el-table__header tr, .el-table__header th {\n  background-color: #eff6ff !important;\n  font-weight: 450 !important;\n  color: #627a94 !important;\n  border-bottom: none !important;\n}\n</style>"]},"metadata":{},"sourceType":"module"}