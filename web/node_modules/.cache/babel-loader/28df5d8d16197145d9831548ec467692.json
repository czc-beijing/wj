{"ast":null,"code":"import container from \"@/components/container\";\nimport { Brush, Minus, Plus, Search, Timer, WarningFilled } from \"@element-plus/icons-vue\";\nimport { ElMessage } from \"element-plus\";\nexport default {\n  name: \"Market\",\n  components: {\n    container,\n    Timer\n  },\n  setup() {\n    return {\n      Search,\n      Brush,\n      Plus,\n      Minus,\n      WarningFilled\n    };\n  },\n  data() {\n    return {\n      query: {\n        id: '',\n        type: '',\n        status: ''\n      },\n      marketList: [],\n      goodsList: [],\n      market: {\n        id: '',\n        bannerImage: '',\n        name: '',\n        type: '',\n        beginTime: '',\n        overTime: '',\n        goodsIds: '',\n        status: ''\n      },\n      typeOption: [{\n        value: 1,\n        label: '钻石展位'\n      }, {\n        value: 2,\n        label: '限时特惠'\n      }],\n      rules: {\n        name: {\n          required: true,\n          message: '请输入一个名称',\n          trigger: 'blur'\n        },\n        bannerImage: {\n          required: true,\n          message: '至少上传一张图片',\n          trigger: 'blur'\n        },\n        type: {\n          required: true,\n          message: '请选择活动类型',\n          trigger: 'blur'\n        },\n        beginTime: {\n          required: true,\n          message: '请设置开始时间',\n          trigger: 'blur'\n        },\n        overTime: {\n          required: true,\n          message: '请设置结束时间',\n          trigger: 'blur'\n        },\n        goodsIds: {\n          required: true,\n          message: '至少关联一个商品',\n          trigger: 'blur'\n        }\n      },\n      // 图片列表\n      pictureList: [],\n      goodsIds: [],\n      selectedGoodsList: [],\n      marketId: '',\n      // 分页\n      total: 0,\n      pageNum: 1,\n      pageSize: 10,\n      // 操作状态\n      dialogTitle: '',\n      operateType: '',\n      marketDialogVisible: false,\n      goodsPopoverVisible: false,\n      // 请求认证\n      token: '',\n      // 空状态\n      showEmpty: false\n    };\n  },\n  mounted() {\n    this.getMarketList();\n    this.token = localStorage.getItem('token');\n  },\n  methods: {\n    // 分页，处理函数\n    handleCurrentChangePrev(val) {\n      this.pageNum = val;\n      console.log(`上一页: ${val}`);\n    },\n    handleCurrentChange(val) {\n      this.pageNum = val;\n      this.getMarketList();\n      console.log(`当前页: ${val}`);\n    },\n    handleCurrentChangeNext(val) {\n      this.pageNum = val;\n      console.log(`下一页: ${val}`);\n    },\n    // 图片上传，处理函数\n    handleImagePreview(file) {\n      this.market.bannerImage = file.url;\n    },\n    handleImageRemove(file, fileList) {\n      this.market.bannerImage = '';\n      console.log(file, fileList);\n    },\n    handleImageSuccess(response) {\n      this.market.bannerImage = response.data;\n    },\n    // 添加活动\n    add() {\n      this.dialogTitle = '添加活动';\n      this.operateType = 'add';\n      this.selectedGoodsList = [];\n      this.marketDialogVisible = true;\n    },\n    // 编辑活动\n    edit(row) {\n      this.dialogTitle = '编辑活动';\n      this.operateType = 'edit';\n      this.market.id = row.id;\n      this.market.name = row.name;\n      this.market.type = row.type;\n      this.market.bannerImage = row.bannerImage;\n      this.pictureList.push({\n        url: row.bannerImage\n      });\n      this.market.beginTime = row.beginTime;\n      this.market.overTime = row.overTime;\n      this.market.goodsIds = row.goodsIds;\n      this.market.status = row.status;\n      this.goodsIds = row.goodsIds.split(',');\n      this.getSelectedGoodsList(row.goodsIds);\n      this.marketDialogVisible = true;\n    },\n    // 获取营销活动列表\n    getMarketList() {\n      this.$axios.get('/market/list', {\n        params: {\n          id: this.query.id,\n          type: this.query.type,\n          status: this.query.status,\n          pageNum: this.pageNum,\n          pageSize: this.pageSize,\n          sid: parseInt(localStorage.getItem('sid'))\n        }\n      }).then(response => {\n        this.total = response.data.data.total;\n        this.marketList = response.data.data.list;\n        if (this.marketList.length === 0) {\n          this.showEmpty = true;\n        }\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    // 开启、关闭活动\n    changeStatus(row) {\n      console.log(row.status);\n      this.$axios.put('/market/status/update', {\n        id: row.id,\n        status: parseInt(row.status)\n      }).then(response => {\n        if (response.data.code === 200 && row.status === 1) {\n          ElMessage({\n            message: '活动已开启',\n            type: 'success'\n          });\n        }\n        if (response.data.code === 200 && row.status === 2) {\n          ElMessage({\n            message: '活动已关闭',\n            type: 'success'\n          });\n        }\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    // 添加关联商品\n    addGoods() {\n      this.getGoodsList();\n      this.goodsPopoverVisible = true;\n    },\n    // 选中时，获取商品ID\n    selectedGoodsIds(selection, row) {\n      this.goodsIds.push(row.id);\n    },\n    // 确认选中的商品\n    confirmSelectedGoods() {\n      this.selectedGoodsList = [];\n      this.market.goodsIds = this.goodsIds.toString();\n      this.goodsList.filter(item => {\n        this.goodsIds.some(id => {\n          if (id === item.id) {\n            this.selectedGoodsList.push(item);\n          }\n        });\n      });\n      this.goodsPopoverVisible = false;\n    },\n    // 移除选中的商品\n    removeSelectedGoods(row) {\n      this.selectedGoodsList.splice(this.selectedGoodsList.indexOf(row.id), 1);\n      this.goodsIds.splice(this.goodsIds.indexOf(row.id), 1);\n      this.market.goodsIds = this.goodsIds.toString();\n      console.log(this.goodsIds);\n    },\n    // 获取已上架商品列表\n    getGoodsList() {\n      this.$axios.get('/market/goods/list', {\n        params: {\n          goodsIds: \"\"\n        }\n      }).then(response => {\n        this.goodsList = response.data.data;\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    // 获取已关联的商品列表\n    getSelectedGoodsList(goodsIds) {\n      this.$axios.get('/market/goods/list', {\n        params: {\n          goodsIds: goodsIds\n        }\n      }).then(response => {\n        this.selectedGoodsList = response.data.data;\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    // 确认添加或编辑活动\n    confirmMarket() {\n      this.$refs['ruleForm'].validate(valid => {\n        if (valid) {\n          if (this.operateType === 'add') {\n            // 添加活动\n            this.$axios.post('/market/create', {\n              name: this.market.name,\n              type: this.market.type,\n              bannerImage: this.market.bannerImage,\n              beginTime: this.market.beginTime,\n              overTime: this.market.overTime,\n              goodsIds: this.market.goodsIds,\n              sid: parseInt(localStorage.getItem('sid'))\n            }).then(response => {\n              if (response.data.code === 200) {\n                ElMessage({\n                  message: response.data.message,\n                  type: 'success'\n                });\n              }\n              this.getMarketList();\n            }).catch(error => {\n              console.log(error);\n            });\n          }\n          if (this.operateType === 'edit') {\n            // 编辑活动\n            this.$axios.put('/market/update', {\n              id: this.market.id,\n              name: this.market.name,\n              type: this.market.type,\n              bannerImage: this.market.bannerImage,\n              beginTime: this.market.beginTime,\n              overTime: this.market.overTime,\n              goodsIds: this.market.goodsIds,\n              status: this.market.status\n            }).then(response => {\n              if (response.data.code === 200) {\n                ElMessage({\n                  message: response.data.message,\n                  type: 'success'\n                });\n              }\n              this.getMarketList();\n            }).catch(error => {\n              console.log(error);\n            });\n          }\n          this.marketDialogVisible = false;\n        } else {\n          console.log('error submit!!');\n          return false;\n        }\n      });\n    },\n    // 删除活动\n    deleteMarket(row) {\n      this.$axios.delete('/market/delete', {\n        params: {\n          id: row.id\n        }\n      }).then(response => {\n        if (response.data.code === 200) {\n          ElMessage({\n            message: response.data.message,\n            type: 'success'\n          });\n        }\n        this.getMarketList();\n      }).catch(error => {\n        console.log(error);\n      });\n    },\n    // 取消\n    cancel() {\n      this.$refs['ruleForm'].resetFields();\n      this.empty();\n      this.marketDialogVisible = false;\n    },\n    // 重置表单\n    resetForm(formName) {\n      this.$refs[formName].resetFields();\n      switch (formName) {\n        case 'query':\n          this.getMarketList();\n          break;\n        case 'ruleForm':\n          this.empty();\n          break;\n        default:\n          console.log('invalid resetForm');\n      }\n    },\n    // 清空数据\n    empty() {\n      this.market.bannerImage = '', this.market.name = '', this.market.type = '', this.market.beginTime = '', this.market.overTime = '', this.market.goodsIds = '', this.goodsIds = '';\n      this.selectedGoodsList = [];\n      this.pictureList = [];\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["container","Brush","Minus","Plus","Search","Timer","WarningFilled","ElMessage","name","components","setup","data","query","id","type","status","marketList","goodsList","market","bannerImage","beginTime","overTime","goodsIds","typeOption","value","label","rules","required","message","trigger","pictureList","selectedGoodsList","marketId","total","pageNum","pageSize","dialogTitle","operateType","marketDialogVisible","goodsPopoverVisible","token","showEmpty","mounted","getMarketList","localStorage","getItem","methods","handleCurrentChangePrev","val","console","log","handleCurrentChange","handleCurrentChangeNext","handleImagePreview","file","url","handleImageRemove","fileList","handleImageSuccess","response","add","edit","row","push","split","getSelectedGoodsList","$axios","get","params","sid","parseInt","then","list","length","catch","error","changeStatus","put","code","addGoods","getGoodsList","selectedGoodsIds","selection","confirmSelectedGoods","toString","filter","item","some","removeSelectedGoods","splice","indexOf","confirmMarket","$refs","validate","valid","post","deleteMarket","delete","cancel","resetFields","empty","resetForm","formName"],"sourceRoot":"","sources":["/Users/work/server/imall/web/src/view/Market.vue"],"sourcesContent":["<template>\n  <container>\n    <!-- 活动查询 -->\n    <el-form :inline=\"true\" :model=\"query\" ref=\"query\" class=\"goods_query_form\">\n      <el-form-item prop=\"id\">\n        <el-input v-model.number=\"query.id\" placeholder=\"活动ID\"/>\n      </el-form-item>\n      <el-form-item prop=\"status\">\n        <el-select v-model=\"query.type\" placeholder=\"活动类型\">\n          <el-option label=\"钻石展位\" value=\"1\"></el-option>\n          <el-option label=\"限时特惠\" value=\"2\"></el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item prop=\"status\">\n        <el-select v-model=\"query.status\" placeholder=\"活动状态\">\n          <el-option label=\"进行中\" value=\"1\"></el-option>\n          <el-option label=\"已结束\" value=\"2\"></el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" :icon=\"Search\" @click=\"getMarketList\">查询</el-button>\n        <el-button type=\"primary\" :icon=\"Brush\" @click=\"resetForm\"/>\n        <el-button type=\"primary\" :icon=\"Plus\" @click=\"add\">活动</el-button>\n      </el-form-item>\n    </el-form>\n    <!-- 活动列表 -->\n    <el-table :data=\"marketList\" height=\"65vh\" style=\"width: 100%\">\n     <el-table-column prop=\"bannerImage\" label=\"活动图片\" min-width=\"50\">\n        <template #default=\"scope\">\n          <el-image :src=\"scope.row.bannerImage\" style=\"border-radius: 5px;\"/>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"name\" label=\"活动名称\"/>\n      <el-table-column prop=\"type\" label=\"活动类型\" min-width=\"50\">\n        <template #default=\"scope\">\n          <el-tag v-if=\"scope.row.type === 1\" type=\"primary\">新品推荐</el-tag>\n          <el-tag v-if=\"scope.row.type === 2\" type=\"primary\">限时特惠</el-tag>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"beginTime\" label=\"开始时间\" min-width=\"100\">\n        <template #default=\"scope\">\n          <div style=\"display: flex; align-items: center\">\n            <el-icon>\n              <timer/>\n            </el-icon>\n            <span style=\"margin-left: 10px\">{{ scope.row.beginTime }}</span>\n          </div>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"overTime\" label=\"结束时间\" min-width=\"100\">\n        <template #default=\"scope\">\n          <div style=\"display: flex; align-items: center\">\n            <el-icon>\n              <timer/>\n            </el-icon>\n            <span style=\"margin-left: 10px\">{{ scope.row.overTime }}</span>\n          </div>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"status\" label=\"状态\" min-width=\"50\">\n        <template #default=\"scope\">\n          <el-switch v-model=\"scope.row.status\" :active-value=\"1\" :inactive-value=\"2\" @click=\"changeStatus(scope.row)\"/>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\">\n        <template #default=\"scope\">\n          <el-button size=\"small\" @click=\"edit(scope.row)\">编辑</el-button>\n          <el-popconfirm title=\"此操作将永久删除该信息, 是否继续?\"\n                         confirmButtonText=\"确认\"\n                         cancelButtonText=\"取消\"\n                         cancelButtonType=\"default\"\n                         :icon=\"WarningFilled\"\n                         @confirm=\"deleteMarket(scope.row)\">\n            <template #reference>\n             <el-button size=\"small\" type=\"danger\">删除</el-button>\n            </template>\n          </el-popconfirm>\n        </template>\n      </el-table-column>\n      <template #empty>\n        <div style=\"margin: 50px 0;\">\n          <el-empty v-if=\"showEmpty\" description=\"暂时还没有活动哦\" />\n        </div>\n      </template>\n    </el-table>\n    <div style=\"padding: 10px 0;\">\n      <el-pagination layout=\"total, prev, pager, next\"\n                   :current-page=\"pageNum\"\n                   :page-size=\"pageSize\"\n                   :total=\"total\"\n                   @current-change=\"handleCurrentChange\"\n                   @prev-click=\"handleCurrentChangePrev\"\n                   @next-click=\"handleCurrentChangeNext\" background/>\n    </div>\n    <!-- 添加、编辑营销，通用对话框 -->\n    <el-dialog :title=\"dialogTitle\" v-model=\"marketDialogVisible\" :lock-scroll=\"false\" top=\"5vh\" width=\"45%\"\n               @close=\"cancel\">\n      <el-form ref=\"ruleForm\" :rules=\"rules\" :model=\"market\" label-width=\"80px\">\n        <el-form-item label=\"活动名称\" prop=\"name\">\n          <el-input v-model=\"market.name\" type=\"text\" maxlength=\"20\" show-word-limit/>\n        </el-form-item>\n        <el-form-item label=\"活动类型\" prop=\"type\">\n          <el-select v-model.number=\"market.type\" placeholder=\"请选择\" clearable>\n            <el-option v-for=\"item in typeOption\" :key=\"item.value\" :label=\"item.label\" :value=\"item.value\"/>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"活动图片\" prop=\"bannerImage\">\n          <el-input v-show=\"false\" v-model=\"market.bannerImage\"/>\n          <el-upload\n              action=\"http://localhost:8000/web/upload\"\n              :headers=\"{'token': token}\"\n              :limit=\"1\"\n              name=\"file\"\n              :file-list=\"pictureList\"\n              list-type=\"picture-card\"\n              :on-preview=\"handleImagePreview\"\n              :on-remove=\"handleImageRemove\"\n              :on-success=\"handleImageSuccess\">\n            <div class=\"goods_image_upload_icon\">+</div>\n          </el-upload>\n        </el-form-item>\n        <el-form-item label=\"开始时间\" prop=\"beginTime\">\n          <el-date-picker v-model=\"market.beginTime\" value-format=\"YYYY-MM-DD HH:mm:ss\" type=\"datetime\" placeholder=\"请选择开始时间\"/>\n        </el-form-item>\n        <el-form-item label=\"结束时间\" prop=\"overTime\">\n          <el-date-picker v-model=\"market.overTime\" value-format=\"YYYY-MM-DD HH:mm:ss\" type=\"datetime\" placeholder=\"请选择结束时间\"/>\n        </el-form-item>\n        <el-form-item label=\"关联商品\" prop=\"goodsIds\">\n          <el-input v-show=\"false\" v-model=\"market.goodsIds\"/>\n          <el-table :data=\"selectedGoodsList\" style=\"width: 100%;\" empty-text=\"您还没有添加活动商品哦\">\n            <el-table-column prop=\"name\" label=\"主图\" width=\"60\">\n              <template #default=\"scope\">\n                <div style=\"display: flex;justify-content: center;align-items: center;\">\n                  <el-image class=\"goods_image\" :src=\"scope.row.imageUrl\"/>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"title\" label=\"标题\">\n              <template #default=\"scope\">\n                <div style=\"font-size: 10px;line-height: 15px;\">{{ scope.row.title }}</div>\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"price\" label=\"价格\" width=\"80\">\n              <template #default=\"scope\">¥ {{ scope.row.price }}</template>\n            </el-table-column>\n            <el-table-column align=\"right\">\n              <template #header>\n                <el-popover placement=\"left\" :width=\"350\" trigger=\"click\" :visible=\"goodsPopoverVisible\">\n                  <template #reference>\n                    <el-button size=\"small\" type=\"primary\" :icon=\"Plus\" @click=\"addGoods\"/>\n                  </template>\n                  <el-table :data=\"goodsList\" height=\"30vh\" style=\"width: 100%\" @select=\"selectedGoodsIds\">\n                    <el-table-column type=\"selection\" width=\"45\"/>\n                    <el-table-column prop=\"name\" label=\"主图\" width=\"60\">\n                      <template #default=\"scope\">\n                        <div style=\"display: flex;justify-content: center;align-items: center;\">\n                          <el-image class=\"goods_image\" :src=\"scope.row.imageUrl\"/>\n                        </div>\n                      </template>\n                    </el-table-column>\n                    <el-table-column prop=\"title\" label=\"标题\">\n                      <template #default=\"scope\">\n                        <div style=\"font-size: 10px;line-height: 15px;\">{{ scope.row.title }}</div>\n                      </template>\n                    </el-table-column>\n                    <el-table-column prop=\"price\" label=\"价格\" width=\"80\">\n                      <template #default=\"scope\">¥ {{ scope.row.price }}</template>\n                    </el-table-column>\n                  </el-table>\n                  <div style=\"text-align: right; margin: 0;padding-top: 10px;\">\n                    <el-button size=\"small\" @click=\"goodsPopoverVisible = false\">取消</el-button>\n                    <el-button size=\"small\" type=\"primary\" @click=\"confirmSelectedGoods\">确定</el-button>\n                  </div>\n                </el-popover>\n              </template>\n              <template #default=\"scope\">\n                <el-button size=\"small\" type=\"danger\" :icon=\"Minus\" @click=\"removeSelectedGoods(scope.row)\" />\n              </template>\n            </el-table-column>\n          </el-table>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <span class=\"dialog-footer\">\n          <el-button @click=\"cancel\">取消</el-button>\n          <el-button @click=\"resetForm('ruleForm')\">重置</el-button>\n          <el-button type=\"primary\" @click=\"confirmMarket\">确定</el-button>\n        </span>\n      </template>\n    </el-dialog>\n  </container>\n</template>\n\n<script>\nimport container from \"@/components/container\";\nimport {Brush, Minus, Plus, Search, Timer, WarningFilled} from \"@element-plus/icons-vue\";\nimport {ElMessage} from \"element-plus\";\n\nexport default {\n  name: \"Market\",\n  components: {container, Timer},\n  setup() {\n    return {Search, Brush, Plus, Minus, WarningFilled}\n  },\n  data() {\n    return {\n      query: {\n        id: '',\n        type: '',\n        status: ''\n      },\n      marketList: [],\n      goodsList: [],\n      market: {\n        id: '',\n        bannerImage: '',\n        name: '',\n        type: '',\n        beginTime: '',\n        overTime: '',\n        goodsIds: '',\n        status: ''\n      },\n      typeOption: [{\n        value: 1,\n        label: '钻石展位'\n      }, {\n        value: 2,\n        label: '限时特惠'\n      }],\n\n      rules: {\n        name: { required: true, message: '请输入一个名称', trigger: 'blur' },\n        bannerImage: { required: true, message: '至少上传一张图片', trigger: 'blur' },\n        type: { required: true, message: '请选择活动类型', trigger: 'blur' },\n        beginTime: { required: true, message: '请设置开始时间', trigger: 'blur' },\n        overTime: { required: true, message: '请设置结束时间', trigger: 'blur' },\n        goodsIds: { required: true, message: '至少关联一个商品', trigger: 'blur' }\n      },\n\n\n      // 图片列表\n      pictureList: [],\n\n      goodsIds: [],\n      selectedGoodsList: [],\n\n      marketId: '',\n\n      // 分页\n      total: 0,\n      pageNum: 1,\n      pageSize: 10,\n\n      // 操作状态\n      dialogTitle: '',\n      operateType: '',\n      marketDialogVisible: false,\n      goodsPopoverVisible: false,\n\n      // 请求认证\n      token: '',\n\n      // 空状态\n      showEmpty: false\n    }\n  },\n  mounted() {\n    this.getMarketList()\n    this.token = localStorage.getItem('token')\n  },\n  methods: {\n    // 分页，处理函数\n    handleCurrentChangePrev(val) {\n      this.pageNum = val;\n      console.log(`上一页: ${val}`);\n    },\n    handleCurrentChange(val) {\n      this.pageNum = val;\n      this.getMarketList()\n      console.log(`当前页: ${val}`);\n    },\n    handleCurrentChangeNext(val) {\n      this.pageNum = val;\n      console.log(`下一页: ${val}`);\n    },\n\n    // 图片上传，处理函数\n    handleImagePreview(file) {\n      this.market.bannerImage = file.url\n    },\n    handleImageRemove(file, fileList) {\n      this.market.bannerImage = ''\n      console.log(file, fileList)\n    },\n    handleImageSuccess(response) {\n      this.market.bannerImage = response.data\n    },\n\n    // 添加活动\n    add() {\n      this.dialogTitle = '添加活动'\n      this.operateType = 'add'\n      this.selectedGoodsList = []\n      this.marketDialogVisible = true\n    },\n\n    // 编辑活动\n    edit(row) {\n      this.dialogTitle = '编辑活动'\n      this.operateType = 'edit'\n      this.market.id = row.id\n      this.market.name = row.name\n      this.market.type = row.type\n      this.market.bannerImage = row.bannerImage\n      this.pictureList.push({url: row.bannerImage})\n      this.market.beginTime = row.beginTime\n      this.market.overTime = row.overTime\n      this.market.goodsIds = row.goodsIds\n      this.market.status = row.status\n      this.goodsIds = row.goodsIds.split(',')\n      this.getSelectedGoodsList(row.goodsIds)\n      this.marketDialogVisible = true\n    },\n\n    // 获取营销活动列表\n    getMarketList() {\n      this.$axios.get('/market/list', {\n        params: {\n          id: this.query.id,\n          type: this.query.type,\n          status: this.query.status,\n          pageNum: this.pageNum,\n          pageSize: this.pageSize,\n          sid: parseInt(localStorage.getItem('sid'))\n        }\n      }).then((response) => {\n        this.total = response.data.data.total;\n        this.marketList = response.data.data.list;\n        if (this.marketList.length === 0) {\n          this.showEmpty = true\n        }\n      }).catch((error) => {\n        console.log(error)\n      })\n    },\n\n    // 开启、关闭活动\n    changeStatus(row){\n      console.log(row.status)\n      this.$axios.put('/market/status/update', {\n        id: row.id,\n        status: parseInt(row.status),\n      }).then((response) => {\n        if (response.data.code === 200 && row.status === 1){\n          ElMessage({message: '活动已开启', type: 'success'})\n        }\n        if (response.data.code === 200 && row.status === 2){\n          ElMessage({message: '活动已关闭', type: 'success'})\n        }\n      }).catch((error) => {\n        console.log(error)\n      })\n    },\n\n    // 添加关联商品\n    addGoods() {\n      this.getGoodsList()\n      this.goodsPopoverVisible = true\n    },\n\n    // 选中时，获取商品ID\n    selectedGoodsIds(selection, row) {\n      this.goodsIds.push(row.id)\n    },\n\n    // 确认选中的商品\n    confirmSelectedGoods() {\n      this.selectedGoodsList = []\n      this.market.goodsIds = this.goodsIds.toString()\n      this.goodsList.filter(item => {\n        this.goodsIds.some(id => { if (id === item.id){ this.selectedGoodsList.push(item) } })\n      })\n      this.goodsPopoverVisible = false\n    },\n\n    // 移除选中的商品\n    removeSelectedGoods(row){\n      this.selectedGoodsList.splice(this.selectedGoodsList.indexOf(row.id), 1)\n      this.goodsIds.splice(this.goodsIds.indexOf(row.id), 1)\n      this.market.goodsIds = this.goodsIds.toString()\n      console.log(this.goodsIds)\n    },\n\n    // 获取已上架商品列表\n    getGoodsList() {\n      this.$axios.get('/market/goods/list', {\n        params: { goodsIds: \"\" }\n      }).then((response) => {\n        this.goodsList = response.data.data;\n      }).catch((error) => {\n        console.log(error)\n      })\n    },\n\n    // 获取已关联的商品列表\n    getSelectedGoodsList(goodsIds) {\n      this.$axios.get('/market/goods/list', {\n        params: { goodsIds: goodsIds }\n      }).then((response) => {\n        this.selectedGoodsList = response.data.data;\n      }).catch((error) => {\n        console.log(error)\n      })\n    },\n\n    // 确认添加或编辑活动\n    confirmMarket() {\n      this.$refs['ruleForm'].validate((valid) => {\n        if (valid) {\n          if (this.operateType === 'add') {\n            // 添加活动\n            this.$axios.post('/market/create', {\n              name: this.market.name,\n              type: this.market.type,\n              bannerImage: this.market.bannerImage,\n              beginTime: this.market.beginTime,\n              overTime: this.market.overTime,\n              goodsIds: this.market.goodsIds,\n              sid: parseInt(localStorage.getItem('sid'))\n            }).then((response) => {\n              if (response.data.code === 200) {\n                ElMessage({message: response.data.message, type: 'success'})\n              }\n              this.getMarketList()\n            }).catch((error) => {\n              console.log(error)\n            })\n          }\n          if (this.operateType === 'edit') {\n            // 编辑活动\n            this.$axios.put('/market/update', {\n              id: this.market.id,\n              name: this.market.name,\n              type: this.market.type,\n              bannerImage: this.market.bannerImage,\n              beginTime: this.market.beginTime,\n              overTime: this.market.overTime,\n              goodsIds: this.market.goodsIds,\n              status: this.market.status\n            }).then((response) => {\n              if (response.data.code === 200) {\n                ElMessage({message: response.data.message, type: 'success'})\n              }\n              this.getMarketList()\n            }).catch((error) => {\n              console.log(error)\n            })\n          }\n          this.marketDialogVisible = false\n        } else {\n          console.log('error submit!!')\n          return false\n        }\n      })\n    },\n\n    // 删除活动\n    deleteMarket(row) {\n      this.$axios.delete('/market/delete', {\n          params: {\n            id: row.id\n          }\n        }).then((response) => {\n          if (response.data.code === 200) {\n            ElMessage({message: response.data.message, type: 'success'})\n          }\n          this.getMarketList()\n        }).catch((error) => {\n          console.log(error)\n      })\n    },\n\n    // 取消\n    cancel() {\n      this.$refs['ruleForm'].resetFields()\n      this.empty()\n      this.marketDialogVisible = false\n    },\n\n    // 重置表单\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n      switch (formName) {\n        case 'query': this.getMarketList(); break;\n        case 'ruleForm': this.empty(); break;\n        default: console.log('invalid resetForm');\n      }\n    },\n\n    // 清空数据\n    empty() {\n      this.market.bannerImage = '',\n      this.market.name = '',\n      this.market.type = '',\n      this.market.beginTime = '',\n      this.market.overTime = '',\n      this.market.goodsIds = '',\n      this.goodsIds = ''\n      this.selectedGoodsList = []\n      this.pictureList = []\n    },\n  }\n}\n</script>\n\n<style scoped>\n.goods_image {\n  width: 35px;\n  height: 35px;\n  border-radius: 5px;\n}\n.el-dialog {\n  border-radius: 10px !important;\n}\n\n.el-upload{\n  width: 100px;\n  height: 100px;\n  line-height: 100px;\n  font-size: 16px;\n}\n\n.el-upload--picture-card {\n  background-color: #F2F4F7;\n  border: none;\n}\n\n.el-upload--picture-card{\n  width: 100px;\n  height: 100px;\n  margin-top: 0;\n  font-size: 16px !important;\n}\n\n.el-upload-list--picture-card .el-upload-list__item{\n  width: 100px;\n  height: 100px;\n  line-height: 100px;\n  font-size: 16px;\n}\n\n.el-upload-list--picture-card .el-upload-list__item-thumbnail{\n  width: 100px;\n  height: 100px;\n  line-height: 100px;\n  font-size: 16px;\n}\n\n.el-table__header tr, .el-table__header th {\n  background-color: #eff6ff !important;\n  font-weight: 450 !important;\n  color: #627a94 !important;\n  border-bottom: none !important;\n}\n</style>"]},"metadata":{},"sourceType":"module"}